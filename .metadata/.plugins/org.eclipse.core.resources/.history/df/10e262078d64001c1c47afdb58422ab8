<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="payMapper">

<insert id="insertPay">
insert into pay(pay_no,pay_method,pay_date)
values(#{pay_no},#{pay_method}, sysdate)
</insert>

<select id="selectPay" resultMap="select_re">
select * from pay order by pay_no desc
</select>
<resultMap type="Pay" id="select_re">
<result column="PAY_NO" property="pay_no"/>
<result column="PAY_METHOD" property="pay_method"/>
<result column="PAY_DATE" property="pay_date"/>
</resultMap>

<update id="updatePay">
update pay set pay_method=#{pay_method} where pay_no=#{pay_no}
</update>

<delete id="deletePay">
delete from pay where pay_no=#{pay_no}
</delete>

<select id="selectOne" resultMap="select_re">
select * from pay where pay_no=#{pay_no}
</select>

<!-- 새 코딩 시작 -->

<select id="cartList" resultMap="cart_list">
select item_name, item_price, cart_amount, cart_item_no, cart_item.item_code, item_count from item
inner join cart_item
on cart_item.item_code=item.item_code
inner join cart
on cart.cart_no=cart_item.cart_no
where cart.mem_id=#{mem_id} order by (cart_amount-item_count), cart_item.cart_item_no desc
</select>
<resultMap type="kr.co.ezenac.pay.model.vo.CartListVO" id="cart_list">
<result column="ITEM_NAME" property="item_name"/>
<result column="ITEM_PRICE" property="item_price"/>
<result column="CART_AMOUNT" property="cart_amount"/>
<result column="CART_ITEM_NO" property="cart_item_no"/>
<result column="ITEM_CODE" property="item_code"/>
<result column="ITEM_COUNT" property="item_count"/>
</resultMap>

<select id="img" resultType="string">
select img_name from images where img_ref='item' and img_id=#{item_code}
</select>

<update id="cartUpdate">
update cart_item set cart_amount=#{cart_amount} where cart_item_no=#{cart_item_no}
</update>

<delete id="cartDelete">
delete from cart_item where cart_item_no=#{cart_item_no}
</delete>

<select id="selectCart" resultMap="cart_list">
select item_name, item_price, cart_amount, cart_item_no, cart_item.item_code, item_count from item
inner join cart_item
on cart_item.item_code=item.item_code
inner join cart
on cart.cart_no=cart_item.cart_no
where cart_item_no=#{cart_item_no} order by cart_item.cart_item_no desc
</select>

<select id="getMember" resultMap="member">
select mem_name, mem_addr1, mem_addr2, mem_addr3, mem_phone from Members where mem_id=#{mem_id}
</select>
<resultMap type="kr.co.ezenac.members.model.vo.MemberVO" id="member">
<result column="MEM_NAME" property="mem_name"/>
<result column="MEM_ADDR1" property="mem_addr1"/>
<result column="MEM_ADDR2" property="mem_addr2"/>
<result column="MEM_ADDR3" property="mem_addr3"/>
<result column="MEM_PHONE" property="mem_phone"/>
</resultMap>

<insert id="insertOrderList">
INSERT INTO ORDER_LIST (ORD_NO, ORD_RECEIVER, ORD_ADDR1, ORD_ADDR2, ORD_ADDR3, ORD_PHONE, DELIVERY_STATUS, ORD_STATUS, MEM_ID, PAY_NO)
VALUES (test_seq.nextval, #{ord_receiver}, #{ord_addr1}, #{ord_addr2}, #{ord_addr3}, #{ord_phone}, '배송중', '준비중', #{mem_id}, #{pay_no})

</insert>
</mapper>